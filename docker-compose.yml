version: '3.8'

services:
  # 1. 스프링 부트 애플리케이션
  app:
    container_name: a-to-zect
    build: .
    ports:
      - "8080:8080"
    depends_on:
      - db # DB가 먼저 켜져야 함
    environment:
      - SPRING_DATASOURCE_URL=jdbc:oracle:thin:@db:1521/xe
      - SPRING_DATASOURCE_USERNAME=az
      - SPRING_DATASOURCE_PASSWORD=dtob
      # JPA 설정 (필요시 주석 해제)
      # - SPRING_JPA_HIBERNATE_DDL_AUTO=update
    restart: always

  # 2. 오라클 데이터베이스
  # (gvenzl/oracle-xe 이미지는 가볍고 애플 실리콘/인텔 모두 호환성이 좋습니다)
  db:
    container_name: atozect-db
    image: gvenzl/oracle-xe:21-slim-faststart
    ports:
      - "1521:1521"
    environment:
      - ORACLE_PASSWORD=oracle  # 비밀번호 설정
    volumes:
      - oracle_data:/opt/oracle/oradata # DB 데이터 영구 저장

# 볼륨 정의 (컨테이너를 껐다 켜도 데이터가 사라지지 않게 함)
volumes:
  oracle_data: