<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>프로젝트 생성</title>
    <link rel="stylesheet" th:href="@{/css/style.css}">

    <style>
        /* 기존 CSS 유지 */
        .mbti-section { display: flex; justify-content: space-between; gap: 10px; margin-top: 10px; padding: 10px; background: #f8f9fa; border-radius: 8px; }
        .mbti-card { flex: 1; background: white; border: 1px solid #ddd; border-radius: 8px; text-align: center; padding: 10px; display: flex; flex-direction: column; gap: 5px; }
        .mbti-title { font-size: 12px; color: #666; margin-bottom: 5px; font-weight: bold; }
        .radio-group { display: flex; justify-content: center; gap: 5px; }
        input[type="radio"] { display: none; }
        input[type="radio"] + label { display: inline-block; width: 40px; height: 40px; line-height: 40px; text-align: center; border: 1px solid #ddd; border-radius: 50%; cursor: pointer; font-weight: bold; color: #333; transition: 0.2s; margin: 0 !important; }
        input[type="radio"]:checked + label { background-color: #007bff; color: white; border-color: #007bff; box-shadow: 0 2px 5px rgba(0,123,255,0.3); }

        .tag-container { display: flex; flex-wrap: wrap; gap: 8px; margin-top: 10px; padding: 10px; background: #fff; border: 1px solid #ddd; border-radius: 6px; min-height: 50px; }
        .tech-tag { background-color: #eef2ff; color: #4f46e5; padding: 5px 10px; border-radius: 20px; font-weight: bold; font-size: 14px; display: flex; align-items: center; gap: 5px; }
        .remove-tag-btn { cursor: pointer; color: #4f46e5; font-weight: bold; border: none; background: none; padding: 0; font-size: 16px; line-height: 1; }
        .remove-tag-btn:hover { color: #dc3545; }
        .input-group { display: flex; gap: 10px; }
    </style>
</head>
<body>

<div class="container">
    <h1>프로젝트 생성</h1>
    <div class="text-right">
        <a href="/" class="btn btn-secondary">목록으로</a>
    </div>
    <hr>

    <div th:if="${error}" class="error-msg" th:text="${error}"></div>

    <form action="/projects/create" method="post" th:object="${projectDto}" id="createForm">

        <h3>1. 기본 정보</h3>
        <div>
            <label>프로젝트 제목</label>
            <input type="text" th:field="*{title}" placeholder="제목을 입력하세요">
        </div>
        <div>
            <label>설명</label>
            <textarea th:field="*{description}" placeholder="프로젝트 설명을 입력하세요"></textarea>
        </div>

        <div>
            <label>최대 모집 인원 (본인 포함)</label>
            <input type="number" th:field="*{maxCount}" min="2" max="20" value="4" placeholder="예: 4명">
            <p style="font-size: 12px; color: #888; margin-top: -10px;">* 최소 2명부터 최대 20명까지 설정 가능합니다.</p>
        </div>

        <hr>

        <h3>2. 기술 스택</h3>
        <p style="font-size: 13px; color: #666; margin-bottom: 5px;">
            필요한 기술 스택을 입력하고 <strong>엔터(Enter)</strong>키를 누르거나 <strong>추가</strong> 버튼을 클릭하세요.
        </p>

        <div style="background: #f8f9fa; padding: 15px; border-radius: 8px;">
            <div class="input-group">
                <input type="text" id="techInput" placeholder="예: Java, React, Figma" style="margin: 0; flex-grow: 1;">
                <button type="button" class="btn btn-primary" onclick="addTechTag()" style="margin: 0;">추가</button>
            </div>

            <div id="tagDisplayArea" class="tag-container">
                <span style="color: #ccc; font-size: 14px;" id="placeholder-text">추가된 스택이 없습니다.</span>
            </div>

            <div id="hiddenInputsContainer"></div>
        </div>

        <hr>

        <h3>3. 선호 MBTI</h3>
        <p style="color: #666; font-size: 14px; margin-bottom: 10px;">
            우리 프로젝트가 선호하는 MBTI를 선택해주세요.
        </p>

        <div class="mbti-section">
            <div class="mbti-card">
                <span class="mbti-title">에너지 방향</span>
                <div class="radio-group">
                    <input type="radio" id="e" name="mbtiMap[1]" value="E" checked><label for="e">E</label>
                    <input type="radio" id="i" name="mbtiMap[1]" value="I"><label for="i">I</label>
                </div>
            </div>
            <div class="mbti-card">
                <span class="mbti-title">인식 방식</span>
                <div class="radio-group">
                    <input type="radio" id="s" name="mbtiMap[2]" value="S" checked><label for="s">S</label>
                    <input type="radio" id="n" name="mbtiMap[2]" value="N"><label for="n">N</label>
                </div>
            </div>
            <div class="mbti-card">
                <span class="mbti-title">판단 방식</span>
                <div class="radio-group">
                    <input type="radio" id="t" name="mbtiMap[3]" value="T" checked><label for="t">T</label>
                    <input type="radio" id="f" name="mbtiMap[3]" value="F"><label for="f">F</label>
                </div>
            </div>
            <div class="mbti-card">
                <span class="mbti-title">생활 양식</span>
                <div class="radio-group">
                    <input type="radio" id="j" name="mbtiMap[4]" value="J" checked><label for="j">J</label>
                    <input type="radio" id="p" name="mbtiMap[4]" value="P"><label for="p">P</label>
                </div>
            </div>
        </div>

        <button type="submit" class="btn btn-primary btn-block" style="margin-top: 40px;">프로젝트 생성 완료</button>
    </form>
</div>

<script>
    const techInput = document.getElementById('techInput');
    const tagDisplayArea = document.getElementById('tagDisplayArea');
    const hiddenInputsContainer = document.getElementById('hiddenInputsContainer');
    const placeholderText = document.getElementById('placeholder-text');

    techInput.addEventListener('keydown', function(e) {
        if (e.key === 'Enter') {
            e.preventDefault();
            addTechTag();
        }
    });

    function addTechTag() {
        const text = techInput.value.trim();
        if (!text) return;

        const existingInputs = document.querySelectorAll('input[name="techSpecs"]');
        for (let input of existingInputs) {
            if (input.value.toLowerCase() === text.toLowerCase()) {
                alert('이미 추가된 스택입니다.');
                techInput.value = '';
                return;
            }
        }

        if (placeholderText) placeholderText.style.display = 'none';

        const tag = document.createElement('div');
        tag.className = 'tech-tag';
        tag.innerHTML = `${text} <span class="remove-tag-btn" onclick="removeTag(this, '${text}')">&times;</span>`;
        tagDisplayArea.appendChild(tag);

        const hiddenInput = document.createElement('input');
        hiddenInput.type = 'hidden';
        hiddenInput.name = 'techSpecs';
        hiddenInput.value = text;
        hiddenInput.id = 'hidden-' + text;
        hiddenInputsContainer.appendChild(hiddenInput);

        techInput.value = '';
        techInput.focus();
    }

    function removeTag(btn, text) {
        const tag = btn.parentElement;
        tag.remove();
        const hiddenInput = document.getElementById('hidden-' + text);
        if (hiddenInput) hiddenInput.remove();
        if (hiddenInputsContainer.children.length === 0) {
            if (placeholderText) placeholderText.style.display = 'inline';
        }
    }
</script>

</body>
</html>