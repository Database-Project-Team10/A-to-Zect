<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>í”„ë¡œì íŠ¸ ìƒì„¸</title>
    <link rel="stylesheet" th:href="@{/css/style.css}">
    <style>
        /* ìƒì„¸ í˜ì´ì§€ ì „ìš© ìŠ¤íƒ€ì¼ (ë‹¤ì‹œ ì •ëˆ) */
        .detail-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 30px;
        }
        .detail-header h1 {
            margin: 0;
            text-align: left;
            font-size: 26px;
            line-height: 1.2;
            color: #222;
        }

        /* ê° ì„¹ì…˜ì„ ê°ì‹¸ëŠ” í°ìƒ‰ ì¹´ë“œ (ë” ê¹”ë”í•˜ê²Œ) */
        .detail-section {
            background: #fff;
            border: 1px solid #e9ecef; /* ë” ì—°í•œ í…Œë‘ë¦¬ */
            border-radius: 12px;
            padding: 30px;
            margin-bottom: 30px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.03);
        }

        /* ì„¹ì…˜ ì œëª© ìŠ¤íƒ€ì¼ (ê¸°ì¡´ ìŠ¤íƒ€ì¼ ë³µêµ¬ + ë²„íŠ¼ ë°°ì¹˜ìš©) */
        .section-title-wrapper {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 25px;
        }
        .section-title {
            margin: 0;
            font-size: 18px;
            font-weight: 700;
            color: #333;
            border-left: 4px solid #007bff; /* íŒŒë€ìƒ‰ í…Œë‘ë¦¬ ë³µêµ¬ */
            padding-left: 12px;
        }

        /* ë¦¬ë” ì „ìš© ë¯¸ë‹ˆ ë²„íŠ¼ ìŠ¤íƒ€ì¼ */
        .btn-manage-mini {
            font-size: 13px;
            color: #888;
            text-decoration: none;
            display: flex;
            align-items: center;
            gap: 5px;
            padding: 4px 8px;
            border-radius: 4px;
            transition: color 0.2s, background 0.2s;
        }
        .btn-manage-mini:hover {
            color: #007bff;
            background: #f1f3f5;
        }

        /* ê¸°íƒ€ ìš”ì†Œ ìŠ¤íƒ€ì¼ */
        .tech-tags-container { display: flex; flex-wrap: wrap; gap: 8px; }
        .mbti-card { background: #f8f9fa; border: 1px solid #eee; border-radius: 10px; padding: 12px 20px; display: flex; align-items: center; }

        /* ëª¨ì§‘ í˜„í™© ë±ƒì§€ */
        .recruit-badge {
            display: inline-block; padding: 5px 12px; border-radius: 20px; font-size: 14px; font-weight: bold; background-color: #eef2ff; color: #4f46e5; margin-top: 10px;
        }
        .recruit-badge.full { background-color: #fff5f5; color: #e03131; border: 1px solid #ffc9c9; }
    </style>
</head>
<body>

<div class="container" style="max-width: 800px; padding-top: 40px;">

    <div class="detail-header">
        <div>
            <h1>ğŸ’» <span th:text="${project.title}">í”„ë¡œì íŠ¸ ì œëª©</span></h1>

            <div>
                <span class="recruit-badge"
                      th:classappend="${project.currentCount >= project.maxCount} ? 'full'"
                      th:text="|ğŸ‘¥ ëª¨ì§‘ í˜„í™©: ${project.currentCount} / ${project.maxCount} ëª…|">
                    1 / 4 ëª…
                </span>
                <span th:if="${project.currentCount >= project.maxCount}"
                      style="font-size: 14px; font-weight: bold; color: #e03131; margin-left: 5px;">
                    (ë§ˆê°)
                </span>
            </div>
        </div>

        <a href="/projects/my" class="btn btn-outline" style="font-size: 14px; padding: 8px 15px;">
            â† ëª©ë¡ìœ¼ë¡œ
        </a>
    </div>

    <div class="detail-section">
        <div class="section-title-wrapper">
            <h3 class="section-title">í”„ë¡œì íŠ¸ ì„¤ëª…</h3>
            <a th:if="${myRole == 'LEADER'}" th:href="@{/projects/{id}/edit(id=${project.id})}" class="btn-manage-mini">
                âœï¸ ê¸°ë³¸ ì •ë³´ ìˆ˜ì •
            </a>
        </div>
        <div style="line-height: 1.8; color: #555; white-space: pre-wrap; font-size: 15px;"
             th:text="${project.description}">ë‚´ìš©</div>
    </div>

    <div class="detail-section">
        <div class="section-title-wrapper">
            <h3 class="section-title">ì‚¬ìš© ê¸°ìˆ  ìŠ¤íƒ</h3>
            <a th:if="${myRole == 'LEADER'}" th:href="@{/projects/{id}/techspecs(id=${project.id})}" class="btn-manage-mini">
                âš™ï¸ ìŠ¤íƒ ê´€ë¦¬
            </a>
        </div>

        <div class="tech-tags-container">
            <th:block th:if="${techSpecs != null && !techSpecs.isEmpty()}">
                <span th:each="spec : ${techSpecs}"
                      class="badge"
                      style="font-size: 14px; padding: 6px 12px;"
                      th:text="${spec.name}">Java</span>
            </th:block>
            <span th:if="${techSpecs == null || techSpecs.isEmpty()}" style="color: #999; font-size: 14px;">
                ë“±ë¡ëœ ê¸°ìˆ  ìŠ¤íƒì´ ì—†ìŠµë‹ˆë‹¤.
            </span>
        </div>
    </div>

    <div class="detail-section">
        <div class="section-title-wrapper">
            <h3 class="section-title">ì„ í˜¸ MBTI</h3>
            <a th:if="${myRole == 'LEADER'}" th:href="@{/projects/{id}/mbti(id=${project.id})}" class="btn-manage-mini">
                âœï¸ MBTI ìˆ˜ì •
            </a>
        </div>

        <div style="display: flex; flex-wrap: wrap; gap: 15px;">
            <div th:each="entry : ${mbtiMap}" class="mbti-card">
                <span style="color: #666; font-size: 13px; font-weight: bold; margin-right: 12px;">
                    <span th:text="'# ëª¨ì§‘ ' + ${entry.key}"># ëª¨ì§‘ 1</span>
                </span>
                <span style="background-color: #eef2ff; color: #4f46e5; padding: 6px 14px; border-radius: 20px; font-weight: 800; font-size: 16px; letter-spacing: 1px;"
                      th:text="${entry.value}">ENTP</span>
            </div>
            <div th:if="${mbtiMap == null || mbtiMap.isEmpty()}"
                 style="padding: 20px; color: #888; font-style: italic; background: #f9f9f9; border-radius: 8px; width: 100%; text-align: center;">
                ğŸŒˆ MBTI ì œí•œ ì—†ìŒ (ëˆ„êµ¬ë‚˜ í™˜ì˜í•©ë‹ˆë‹¤!)
            </div>
        </div>
    </div>

    <div class="detail-section" style="border-color: #007bff; background-color: #f8fbff; box-shadow: 0 8px 20px rgba(0,123,255,0.08);">
        <h3 class="section-title" style="margin-bottom: 25px;">ğŸš€ í”„ë¡œì íŠ¸ ì°¸ì—¬</h3>

        <div th:if="${myRole == 'LEADER'}">
            <a th:href="@{/projects/{id}/participants/applicants(id=${project.id})}" class="btn btn-primary btn-block" style="padding: 15px; font-size: 16px;">
                ğŸ‘¥ ì‹ ì²­ì ê´€ë¦¬
            </a>
        </div>

        <div th:if="${myRole == 'MEMBER'}">
            <button class="btn btn-success btn-block" disabled style="opacity: 1; cursor: default; padding: 15px; font-size: 16px;">
                âœ… í˜„ì¬ íŒ€ì›ìœ¼ë¡œ ì°¸ì—¬ ì¤‘ì…ë‹ˆë‹¤.
            </button>
        </div>

        <div th:if="${myRole == 'PENDING'}">
            <button class="btn btn-secondary btn-block" disabled style="cursor: default; padding: 15px; font-size: 16px;">
                ğŸ•’ ë¦¬ë”ì˜ ìŠ¹ì¸ì„ ê¸°ë‹¤ë¦¬ê³  ìˆìŠµë‹ˆë‹¤...
            </button>
        </div>

        <div th:if="${myRole == null}">
            <form th:if="${project.currentCount < project.maxCount}"
                  th:action="@{|/projects/${project.id}/participants/apply|}" method="post">
                <button type="submit" class="btn btn-primary btn-block"
                        style="padding: 15px; font-size: 16px;"
                        onclick="return confirm('í”„ë¡œì íŠ¸ì— ì°¸ê°€ ì‹ ì²­í•˜ì‹œê² ìŠµë‹ˆê¹Œ?');">
                    ğŸš€ ì°¸ê°€ ì‹ ì²­í•˜ê¸°
                </button>
            </form>

            <button th:if="${project.currentCount >= project.maxCount}"
                    class="btn btn-danger btn-block" disabled style="padding: 15px; font-size: 16px;">
                ğŸš« ëª¨ì§‘ì´ ë§ˆê°ë˜ì—ˆìŠµë‹ˆë‹¤.
            </button>
        </div>
    </div>

    <div class="detail-section" style="background: #fbfbfc; border-color: #e9ecef;">
        <h3 class="section-title" style="border-left-color: #28a745;">í”„ë¡œì íŠ¸ í™œë™</h3>

        <div class="menu-grid" style="margin-top: 25px;"
             th:styleappend="${myRole != 'LEADER' and myRole != 'MEMBER'} ? 'opacity: 0.5; pointer-events: none;' : ''">

            <a th:href="@{/projects/{id}/participants(id=${project.id})}"
               class="btn btn-outline btn-block"
               style="color: #555; background: white; padding: 20px; font-size: 15px; display: block; text-decoration: none;">
                ğŸ‘¥ í•¨ê»˜í•˜ëŠ” íŒ€ì›
            </a>

            <a th:href="@{|/projects/${project.id}/posts|}"
               class="btn btn-outline btn-block"
               style="color: #555; background: white; padding: 20px; font-size: 15px; display: block; text-decoration: none;">
                ğŸ“‹ ê²Œì‹œíŒ
            </a>


            <a th:href="@{|/projects/${project.id}/links|}" 
            class="btn btn-outline btn-block" 
            style="color: #555; background: white; padding: 20px; font-size: 15px; display: block; text-decoration: none;">
             ğŸ”— ë§í¬ ì•„ì¹´ì´ë¸Œ
         </a>

            <a th:href="@{/projects/{id}/documents(id=${project.id})}"
               class="btn btn-outline btn-block"
               style="color: #555; background: white; padding: 20px; font-size: 15px; display: block; text-decoration: none;">
                ğŸ—ƒï¸ ë¬¸ì„œ ì•„ì¹´ì´ë¸Œ
            </a>

            <a th:href="@{|/projects/${project.id}/meetings|}" 
            class="btn btn-outline btn-block" 
            style="color: #555; background: white; padding: 20px; font-size: 15px; display: block; text-decoration: none;">
             ğŸ’¬ íšŒì˜ë¡ ì•„ì¹´ì´ë¸Œ
         </a>
        </div>

        <div th:if="${myRole != 'LEADER' and myRole != 'MEMBER'}"
             style="text-align: center; font-size: 13px; color: #999; margin-top: 15px;">
            * í”„ë¡œì íŠ¸ íŒ€ì›ì´ ë˜ë©´ ì´ìš©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
        </div>
    </div>

</div>

<script th:inline="javascript" th:if="${param.error}">
    alert([[${param.error}]]);
</script>

</body>
</html>